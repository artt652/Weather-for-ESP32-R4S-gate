# Weather-for-ESP32-R4S-gate

Вывод прогноза погоды для устройств с экраном для проекта ESP32 Ready4Sky (R4S) Gateway for Redmond+ devices (@alutov)

  Описание скрипта: 

Думал, что же можно сделать на устройстве с экраном (М5 stack), чтобы выводить больше полезной информации, т.к камеры как у автора шлюза у меня нет, а показ статичной картинки не очень то и интересно.

Решил выводить прогноз погоды, используя веб сервис погодных информеров. 

Но оказалось что: 
    1. большинство современных погодных информеров это не картинки, а html код.
    2. Сервисы которые все же отдают картинки - нашел meteoservice.ru, rp5.ru, и wttr.in - делают это в PNG а не JPG.
    3. Шлюз не поддерживает загрузки по https.

Выполнение скрипта реализуется на базе простого PHP сервера в локальной сети с доступом к интернету, доступ к исполняемому файлу из инернета не обязателен.

Скрипт грузит с сервиса по https информер-картинку с прогнозом, конвертирует в jpg, изменяет разрешение под экран шлюза и сохраняет картинку в свою папку, откуда шлюз уже может забрать её по http.
Обновление данных происходит через запрос страницы в локальной сети либо через интернет, вручную или по таймеру (у меня установлен таймер через автоматизацию в HA). 
Для отправки автоматического запроса используется интеграция Webhook Service Provider for Home Assistant (@HCookie).

В настройках шлюза указвается адрес генерируемой картинки в папке со скриптом: 

http://your.ip.or.hostname/your.path/weather.jpg

и выставляется желаемое время обновления в секундах. 

Ссылки на конкретный город и тип информера а так же их описание можно найти на сайтах сервисов. Для работы через сервис wttr.in необходимо отредактировать только ссылку для загрузки прогноза нужной локации.

